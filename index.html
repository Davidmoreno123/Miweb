<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Gestión de Accesos</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input, button { margin: 5px; padding: 8px; }
    .registro, .logs { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>Registro de Usuarios</h1>

  <div class="registro">
    <input type="text" id="nombre" placeholder="Nombre">
    <input type="text" id="huella_id" placeholder="ID de Huella">
    <input type="text" id="contraseña" placeholder="Contraseña">
    <button onclick="registrarUsuario()">Registrar</button>
  </div>

  <h2>Registros de Acceso</h2>
  <div class="logs">
    <button onclick="verLogs()">Ver Logs</button>
    <ul id="log-list"></ul>
  </div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.5.0/+esm'

    const supabaseUrl = 'https://fcltepdtcsddeudjmzjc.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZjbHRlcGR0Y3NkZGV1ZGptempjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUzNzk5MDgsImV4cCI6MjA2MDk1NTkwOH0.snOcWct0K2lApgjgqfjpq67R5-NZQ1kH3vwvnImzPtM';

    const supabase = createClient(supabaseUrl, supabaseKey);

    async function registrarUsuario() {
      const nombre = document.getElementById('nombre').value;
      const huella_id = document.getElementById('huella_id').value;
      const contraseña = document.getElementById('contraseña').value;

      if (!nombre || !huella_id || !contraseña) {
        alert("Por favor completa todos los campos.");
        return;
      }

      const { data, error } = await supabase
        .from('usuarios')
        .insert([{ nombre, huella_id, contraseña }]);

      if (error) {
        alert("Error al registrar: " + error.message);
        console.error(error);
      } else {
        alert("Usuario registrado correctamente.");
      }
    }

    async function verLogs() {
      const { data, error } = await supabase
        .from('logs')
        .select('*')
        .order('timestamp', { ascending: false });

      const logList = document.getElementById('log-list');
      logList.innerHTML = '';

      if (error) {
        console.error("Error al obtener logs:", error);
        return;
      }

      data.forEach(log => {
        const li = document.createElement('li');
        li.textContent = `${log.nombre || 'Usuario'} accedió el ${new Date(log.timestamp).toLocaleString()}`;
        logList.appendChild(li);
      });
    }
  </script>
</body>
</html>
